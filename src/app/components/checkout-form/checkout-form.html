
<form [formGroup]="checkoutForm" (ngSubmit)="submit()">
    
    <section>
        <h2>checkout</h2>

        <div class="form-group" formGroupName="billingDetails">
            <h5>billing details</h5>

            <div class="input-fields">
                <div class="input-group" [class.invalid]="checkoutForm.get('billingDetails.name')?.invalid && 
                    (checkoutForm.get('billingDetails.name')?.touched || checkoutForm.get('billingDetails.name')?.dirty)">
                    <label for="name">Name</label>
                    <input type="text" id="name" placeholder="Alexi Ward" autocomplete="name" formControlName="name">
                    @if(checkoutForm.get('billingDetails.name')?.invalid && 
                        (checkoutForm.get('billingDetails.name')?.touched || checkoutForm.get('billingDetails.name')?.dirty)) {
        
                        @if (checkoutForm.get('billingDetails.name')?.errors?.['required']) {
                            <small class="error">Can't be empty</small>
                        }
                        @if (checkoutForm.get('billingDetails.name')?.errors?.['minlength']) {
                            <small class="error">Name must be at least 3 characters</small>
                        }
                    }
                </div>

                <div class="input-group" [class.invalid]="checkoutForm.get('billingDetails.email')?.invalid && 
                    (checkoutForm.get('billingDetails.email')?.touched || checkoutForm.get('billingDetails.email')?.dirty)">

                    <label for="email">Email Address</label>
                    <input type="email" id="email" placeholder="alexi@mail.com" autocomplete="email" formControlName="email"
                    >
                    @if(checkoutForm.get('billingDetails.email')?.invalid && 
                        (checkoutForm.get('billingDetails.email')?.touched || checkoutForm.get('billingDetails.email')?.dirty)) {
        
                        @if (checkoutForm.get('billingDetails.email')?.errors?.['required']) {
                            <small class="error">Can't be empty</small>
                        }
                        @if (checkoutForm.get('billingDetails.email')?.errors?.['email']) {
                            <small class="error">Wrong Format</small>
                        }
                    }
                </div>

                <div class="input-group" [class.invalid]="checkoutForm.get('billingDetails.phone')?.invalid && 
                    (checkoutForm.get('billingDetails.phone')?.touched || checkoutForm.get('billingDetails.phone')?.dirty)">

                    <label for="phone">Phone Number</label>
                    <input type="number" id="phone" placeholder="+1 202-555-0136" autocomplete="tel" formControlName="phone">
                    @if(checkoutForm.get('billingDetails.phone')?.invalid && 
                        (checkoutForm.get('billingDetails.phone')?.touched || checkoutForm.get('billingDetails.phone')?.dirty)) {
        
                        @if (checkoutForm.get('billingDetails.phone')?.errors?.['required']) {
                            <small class="error">Can't be empty</small>
                        }
                        @if (checkoutForm.get('billingDetails.phone')?.errors?.['invalidPhoneNumber']) {
                            <small class="error">Invalid phone number</small>
                        }
                    }
                </div>
            </div>
        </div>

        <div class="form-group" formGroupName="shippingInfo">
            <h5>shipping info</h5>

            <div class="input-fields" id="shipping">
                <div class="input-group" [class.invalid]="checkoutForm.get('shippingInfo.address')?.invalid && 
                    (checkoutForm.get('shippingInfo.address')?.touched || checkoutForm.get('shippingInfo.address')?.dirty)">

                    <label for="address">Your Address</label>
                    <input type="text" id="address" placeholder="1137 Williams Avenue" autocomplete="street-address" formControlName="address">
                    @if(checkoutForm.get('shippingInfo.address')?.invalid && 
                        (checkoutForm.get('shippingInfo.address')?.touched || checkoutForm.get('shippingInfo.address')?.dirty)) {
        
                        @if (checkoutForm.get('shippingInfo.address')?.errors?.['required']) {
                            <small class="error">Can't be empty</small>
                        }
                        @if (checkoutForm.get('shippingInfo.address')?.errors?.['minlength']) {
                            <small class="error">Address must be at least 3 characters</small>
                        }
                    }
                </div>

                <div id="shipping-info">

                    <div class="input-group" [class.invalid]="checkoutForm.get('shippingInfo.zipCode')?.invalid && 
                    (checkoutForm.get('shippingInfo.zipCode')?.touched || checkoutForm.get('shippingInfo.zipCode')?.dirty)">
                        <label for="code">Zip Code</label>
                        <input type="number" id="code" placeholder="10001" autocomplete="postal-code" formControlName="zipCode">
                        @if(checkoutForm.get('shippingInfo.zipCode')?.invalid && 
                            (checkoutForm.get('shippingInfo.zipCode')?.touched || checkoutForm.get('shippingInfo.zipCode')?.dirty)) {
        
                            @if (checkoutForm.get('shippingInfo.zipCode')?.errors?.['required']) {
                                <small class="error">Can't be empty</small>
                            }
                        }
                    </div>
    
                    <div class="input-group" [class.invalid]="checkoutForm.get('shippingInfo.city')?.invalid && 
                    (checkoutForm.get('shippingInfo.city')?.touched || checkoutForm.get('shippingInfo.city')?.dirty)">

                        <label for="city">City</label>
                        <input type="text" id="city" placeholder="New York" autocomplete="address-level2" formControlName="city">
                        @if(checkoutForm.get('shippingInfo.city')?.invalid && 
                            (checkoutForm.get('shippingInfo.city')?.touched || checkoutForm.get('shippingInfo.city')?.dirty)) {
        
                            @if (checkoutForm.get('shippingInfo.city')?.errors?.['required']) {
                                <small class="error">Can't be empty</small>
                            }
                        }
                    </div>
    
                    <div class="input-group" [class.invalid]="checkoutForm.get('shippingInfo.country')?.invalid && 
                    (checkoutForm.get('shippingInfo.country')?.touched || checkoutForm.get('shippingInfo.country')?.dirty)">

                        <label for="country">Country</label>
                        <input type="text" id="country" placeholder="United States" autocomplete="country-name" formControlName="country">
                        @if(checkoutForm.get('shippingInfo.country')?.invalid && 
                            (checkoutForm.get('shippingInfo.country')?.touched || checkoutForm.get('shippingInfo.country')?.dirty)) {
        
                            @if (checkoutForm.get('shippingInfo.country')?.errors?.['required']) {
                                <small class="error">Can't be empty</small>
                            }
                        }
                    </div>
                </div>
            </div>
        </div>

        <div class="form-group" formGroupName="payment">
            <h5>payment details</h5>

            <div class="input-fields">

                <p>Payment Method</p>

                <div id="shipping">

                    <div class="radio-group">
                        <label>
                            <input type="radio" name="method" value="e-money" formControlName="method">
                            <span class="custom-radio"></span>
                            e-Money
                        </label>
                    </div>
    
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="method" value="cash" formControlName="method">
                            <span class="custom-radio"></span>
                            Cash on Delivery
                        </label>
                    </div>
                </div>
            </div>
            
        </div>

        <div class="form-group" formGroupName="payment">

            <div class="input-fields">
                @if (isVirtual()) {
                    <div class="input-group" [class.invalid]="checkoutForm.get('payment.eMoneyNumber')?.invalid 
                            && (checkoutForm.get('payment.eMoneyNumber')?.dirty || checkoutForm.get('payment.eMoneyNumber')?.touched)">
                        <label for="e-money-number">e-money Number</label>
                        <input type="number" id="e-money-number" placeholder="234567890" autocomplete="tel" formControlName="eMoneyNumber">
                        @if (checkoutForm.get('payment.eMoneyNumber')?.invalid 
                            && (checkoutForm.get('payment.eMoneyNumber')?.dirty || checkoutForm.get('payment.eMoneyNumber')?.touched)) {
                            @if (checkoutForm.get('payment.eMoneyNumber')?.errors?.['required']) {
                            <small class="error">Can't be empty</small>
                            }
                            @if (checkoutForm.get('payment.eMoneyNumber')?.errors?.['minlength']) {
                            <small class="error">Number must be at least 9 digits</small>
                            }
                        }
                    </div>
            
                    <div class="input-group" [class.invalid]="checkoutForm.get('payment.eMoneyPin')?.invalid 
                            && (checkoutForm.get('payment.eMoneyPin')?.dirty || checkoutForm.get('payment.eMoneyPin')?.touched)">
                        <label for="e-money-pin">e-money PIN</label>
                        <input type="number" id="e-money-pin" placeholder="0001" formControlName="eMoneyPin">
                        @if (checkoutForm.get('payment.eMoneyPin')?.invalid 
                            && (checkoutForm.get('payment.eMoneyPin')?.dirty || checkoutForm.get('payment.eMoneyPin')?.touched)) {
                            @if (checkoutForm.get('payment.eMoneyPin')?.errors?.['required']) {
                            <small class="error">Can't be empty</small>
                            }
                            @if (checkoutForm.get('payment.eMoneyPin')?.errors?.['minlength']) {
                            <small class="error">PIN must be at least 4 digits</small>
                            }
                        }
                    </div>
                }
                @else {
                    <div class="cash-info">
                        <img src="/assets/icons/Shape.svg" alt="money exchange">
                        <p class="description">The ‘Cash on Delivery’ option enables you to pay in cash when our delivery courier
                            arrives at your residence. Just make sure your address is correct so that your order will not be cancelled.
                        </p>
                    </div>
                }

            </div>
        </div>
    </section>

    <section class="summary">
        <h3>summary</h3>

        <div class="items">
            @for (item of cartItems(); track item.id) {
                <div class="item">
                        <div class="left-side">
    
                            @if (imageList()[$index]) {
                                <div class="image">
                                    <img 
                                        [src]="imageList()[$index][0].mobile_url" 
                                        alt="Product image"
                                    />
                                </div>
                        }
    
                            <div class="col">
                                <p class="name">{{item.name}}</p>
                                <span class="price">{{item.price | currency:'USD':'symbol':'1.0-0'}}</span>
                            </div>
                        </div>
    
                        <span class="quantity">x{{item.quantity}}</span>
                </div>
            }
        </div>

        <div class="text-container">

            <div class="total-checkout">
                <div class="total">
                    <p>total</p>
                    <span>{{total() | currency:'USD':'symbol':'1.0-0'}}</span>
                </div>
                <div class="total">
                    <p>shipping</p>
                    <span>{{shippingFee() | currency:'USD':'symbol':'1.0-0'}}</span>
                </div>
                <div class="total">
                    <p>vat (included)</p>
                    <span>{{vat() | currency:'USD':'symbol':'1.0-0'}}</span>
                </div>
            </div>

            <div class="total">
                <p>grand total</p>
                <span class="grand">{{grandTotal() | currency:'USD':'symbol':'1.0-0'}}</span>
            </div>
        </div>

        <app-button [label]="'continue & pay'" [disabled]="!checkoutForm.valid" (click)="submit()"/>
        
    </section>
</form>

<router-outlet name="modal"/>
